attack_technique: T1562.001
display_name: 'Impair Defenses: Disable or Modify Tools'
atomic_tests:
  - name: Tamper with MDE via Registry
    auto_generated_guid: 194e9c50-9b92-49b8-8944-001ff6537d84
    description: |
      Changes registry keys used by MDE to enable/disable features.
    supported_platforms:
      - windows
    executor:
      command: |
        New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Exclusions\Paths" -Force
        Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Exclusions\Paths" -Name "atomic_test" -Value 1
        Get-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Exclusions\Paths"
      cleanup_command: |
        Remove-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Exclusions\Paths" -Name "atomic_test"
      name: powershell
      elevation_required: true
  - name: Tamper with Microsoft Defender for Endpoint Configuration - Add Exclusion
    description: |
      Tamper with Microsoft Defender for Endpoint configuration by adding an exclusion to the list of excluded file paths.
    supported_platforms:
      - windows
    input_arguments:
      excluded_path:
        description: The path to be added as an exclusion
        type: path
        default: C:\Windows\Temp\excluded_folder
    executor:
      command: |
        Add-MpPreference -ExclusionPath "#{excluded_path}"
        Get-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Exclusions\Paths"
      cleanup_command: |
        Remove-MpPreference -ExclusionPath "#{excluded_path}"
      name: powershell
      elevation_required: true